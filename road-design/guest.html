<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚²ã‚¹ãƒˆã‚¢ã‚¯ã‚»ã‚¹ - é“è·¯è©³ç´°è¨­è¨ˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .guest-notice {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            text-align: center;
        }

        .guest-notice h3 {
            color: #1976d2;
            margin-bottom: 8px;
            font-size: 18px;
        }

        .guest-notice p {
            color: #666;
            margin: 0;
            font-size: 14px;
        }

        .guest-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .guest-mode-badge {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
            margin-left: 8px;
        }

        .project-guest-view {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .project-guest-view h4 {
            margin: 0 0 8px 0;
            color: #495057;
        }

        .project-meta-guest {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
        }

        .login-prompt {
            text-align: center;
            margin-top: 32px;
            padding: 24px;
            background: linear-gradient(135deg, #fff3e0 0%, #fce4ec 100%);
            border-radius: 8px;
            border: 1px solid #ffcc02;
        }

        .login-prompt h3 {
            color: #f57c00;
            margin-bottom: 8px;
        }

        .login-prompt p {
            color: #666;
            margin-bottom: 16px;
        }

        .restricted-feature {
            position: relative;
            opacity: 0.6;
            pointer-events: none;
        }

        .restricted-feature::after {
            content: 'ğŸ”’ ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="header">
            <div class="header-left">
                <h1 class="app-title">ğŸ›£ï¸ é“è·¯è©³ç´°è¨­è¨ˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
                <span class="guest-mode-badge">ã‚²ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰</span>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" id="loginBtn">ãƒ­ã‚°ã‚¤ãƒ³</button>
            </div>
        </header>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <main class="main-content">
            <!-- ã‚²ã‚¹ãƒˆé€šçŸ¥ -->
            <div class="guest-notice">
                <h3>ğŸ‘ï¸ ã‚²ã‚¹ãƒˆã‚¢ã‚¯ã‚»ã‚¹ãƒ¢ãƒ¼ãƒ‰</h3>
                <p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åŸºæœ¬æƒ…å ±ã¨é€²æ—çŠ¶æ³ã‚’é–²è¦§ã§ãã¾ã™ã€‚ä¸€éƒ¨ã®æ©Ÿèƒ½ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚</p>
            </div>

            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div class="guest-actions">
                <button class="btn btn-info" onclick="refreshProjects()">ğŸ”„ æ›´æ–°</button>
                <button class="btn btn-success" onclick="showLoginPrompt()">ğŸš€ ãƒ­ã‚°ã‚¤ãƒ³</button>
            </div>

            <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ -->
            <section class="project-section">
                <div class="project-header">
                    <h2>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</h2>
                    <span id="projectCount">èª­ã¿è¾¼ã¿ä¸­...</span>
                </div>

                <div id="projectsContainer">
                    <div class="loading" style="text-align: center; padding: 40px;">
                        <div class="loading-spinner" style="display: inline-block; margin-right: 8px;"></div>
                        ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...
                    </div>
                </div>
            </section>

            <!-- æ©Ÿèƒ½åˆ¶é™ã®ãŠçŸ¥ã‚‰ã› -->
            <div class="login-prompt">
                <h3>ğŸš€ ã‚ˆã‚Šå¤šãã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹</h3>
                <p>ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã“ã¨ã§ã€ã‚¿ã‚¹ã‚¯ã®ç·¨é›†ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ç®¡ç†è€…æ©Ÿèƒ½ãªã©<br>ã™ã¹ã¦ã®æ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚</p>
                <button class="btn btn-primary" onclick="window.location.href='login.html'">ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸</button>
            </div>
        </main>
    </div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal-overlay" id="loginPromptModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</h3>
                <button class="modal-close" onclick="hideLoginPrompt()">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center; padding: 24px;">
                <p style="margin-bottom: 20px;">ã“ã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚</p>
                <button class="btn btn-primary" onclick="window.location.href='login.html'">ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹</button>
                <button class="btn btn-secondary" onclick="hideLoginPrompt()" style="margin-left: 12px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <script>
        let projects = [];

        // ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Guest page initialized');

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            setupGuestPage();

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿
            loadProjects();
        });

        // ã‚²ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        function setupGuestPage() {
            // ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('loginBtn').addEventListener('click', function() {
                window.location.href = 'login.html';
            });
        }

        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿
        async function loadProjects() {
            const loading = document.getElementById('loadingOverlay');
            loading.classList.add('active');

            try {
                console.log('Loading projects for guest...');

                const response = await fetch('api.php?path=projects', {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });

                const result = await response.json();
                console.log('Projects loaded:', result);

                if (result.success) {
                    projects = result.projects || [];
                    displayProjects(projects);
                } else {
                    console.error('Failed to load projects:', result.message);
                    showError('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                }
            } catch (error) {
                console.error('Error loading projects:', error);
                showError('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
            } finally {
                loading.classList.remove('active');
            }
        }

        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¤º
        function displayProjects(projects) {
            const container = document.getElementById('projectsContainer');
            const countElement = document.getElementById('projectCount');

            countElement.textContent = `${projects.length}ä»¶`;

            if (projects.length === 0) {
                container.innerHTML = '<div class="empty-state">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
                return;
            }

            container.innerHTML = '';

            projects.forEach(project => {
                const projectElement = createProjectElement(project);
                container.appendChild(projectElement);
            });
        }

        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦ç´ ä½œæˆ
        function createProjectElement(project) {
            const projectDiv = document.createElement('div');
            projectDiv.className = 'project-guest-view';

            // å®Œäº†ã‚¿ã‚¹ã‚¯æ•°ã¨ç·ã‚¿ã‚¹ã‚¯æ•°ã‚’è¨ˆç®—
            const totalTasks = project.total_tasks || 0;
            const completedTasks = project.completed_tasks || 0;
            const progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            projectDiv.innerHTML = `
                <h4>${project.name || 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåãªã—'}</h4>
                <div class="project-meta-guest">
                    <span>ğŸ“… ${project.start_date || 'é–‹å§‹æ—¥æœªè¨­å®š'} ï½ ${project.target_end_date || 'çµ‚äº†æ—¥æœªè¨­å®š'}</span>
                    <span>ğŸ“Š é€²æ—: ${progressPercent}% (${completedTasks}/${totalTasks})</span>
                    <span>ğŸ¢ ${project.client_name || 'ç™ºæ³¨è€…æœªè¨­å®š'}</span>
                </div>
                <div style="margin-top: 12px;">
                    <div style="background: #e9ecef; border-radius: 4px; height: 8px; overflow: hidden;">
                        <div style="background: linear-gradient(90deg, #28a745, #20c997); height: 100%; width: ${progressPercent}%; transition: width 0.3s ease;"></div>
                    </div>
                </div>
                <div style="margin-top: 12px; font-size: 12px; color: #666;">
                    <button class="btn btn-sm btn-info" onclick="showLoginPrompt()" style="font-size: 12px; padding: 4px 8px;">è©³ç´°ã‚’è¦‹ã‚‹</button>
                </div>
            `;

            return projectDiv;
        }

        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ›´æ–°
        function refreshProjects() {
            loadProjects();
        }

        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤º
        function showLoginPrompt() {
            document.getElementById('loginPromptModal').style.display = 'flex';
        }

        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆéè¡¨ç¤º
        function hideLoginPrompt() {
            document.getElementById('loginPromptModal').style.display = 'none';
        }

        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function showError(message) {
            const container = document.getElementById('projectsContainer');
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #dc3545;">
                    <h3>âš ï¸ ã‚¨ãƒ©ãƒ¼</h3>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="loadProjects()">å†è©¦è¡Œ</button>
                </div>
            `;
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        window.refreshProjects = refreshProjects;
        window.showLoginPrompt = showLoginPrompt;
        window.hideLoginPrompt = hideLoginPrompt;
    </script>
</body>
</html>
