# データベース変更時に修正が必要なファイル一覧

## 📋 概要
道路詳細設計管理システムでデータベースを変更した際に修正が必要なファイルの一覧と修正手順をまとめています。

## 🔧 必須修正ファイル

### 1. **`config.php`** - 最重要
- **ファイルパス**: `road-design/config.php`
- **修正内容**: データベース接続情報の更新
- **対象項目**:
  ```php
  define('DB_HOST', 'localhost');        // データベースホスト
  define('DB_PORT', '3306');             // ポート番号
  define('DB_NAME', 'roadplan_road');    // データベース名
  define('DB_USER', 'roadplan_road');    // ユーザー名
  define('DB_PASS', '8R23ENvs');         // パスワード
  define('DB_CHARSET', 'utf8mb4');       // 文字セット
  ```
- **重要度**: ⭐⭐⭐⭐⭐ (最重要)

### 2. **`database.php`** - 自動対応
- **ファイルパス**: `road-design/database.php`
- **修正内容**: 基本的には修正不要（`config.php`から設定を読み込むため）
- **注意点**: データベーススキーマが変更された場合は、クエリの修正が必要
- **重要度**: ⭐⭐⭐ (スキーマ変更時のみ)

## 🛠️ 設定更新用スクリプト

### 3. **`update_config_for_new_db.php`**
- **ファイルパス**: `road-design/update_config_for_new_db.php`
- **用途**: 新しいデータベース設定への自動更新
- **修正内容**: スクリプト内の新しいデータベース情報を更新
- **重要度**: ⭐⭐⭐⭐

### 4. **`restore_database.php`**
- **ファイルパス**: `road-design/restore_database.php`
- **用途**: データベース復元時の設定
- **修正内容**: 復元先のデータベース情報を更新
- **重要度**: ⭐⭐⭐

### 5. **`test_new_database.php`**
- **ファイルパス**: `road-design/test_new_database.php`
- **用途**: 新しいデータベースの接続テスト
- **修正内容**: テスト対象のデータベース情報を更新
- **重要度**: ⭐⭐⭐

## 📊 バックアップ・復元関連

### 6. **`backup_database.php`**
- **ファイルパス**: `road-design/backup_database.php`
- **修正内容**: 基本的には修正不要（`config.php`から設定を読み込むため）
- **重要度**: ⭐⭐

### 7. **`install.php`**
- **ファイルパス**: `road-design/install.php`
- **修正内容**: 基本的には修正不要（`config.php`から設定を読み込むため）
- **重要度**: ⭐⭐

## 🔍 テスト・確認用ファイル

### 8. **`test_connection_api.php`**
- **ファイルパス**: `road-design/test_connection_api.php`
- **修正内容**: 基本的には修正不要（`config.php`から設定を読み込むため）
- **重要度**: ⭐⭐

### 9. **`test_db_connection.html`**
- **ファイルパス**: `road-design/test_db_connection.html`
- **修正内容**: 基本的には修正不要（API経由でテストするため）
- **重要度**: ⭐

## 📚 移行ガイド

### 10. **`migrate_database.md`**
- **ファイルパス**: `road-design/migrate_database.md`
- **修正内容**: 移行手順書の更新（必要に応じて）
- **重要度**: ⭐⭐

## 🚀 推奨修正手順

### ステップ1: 設定ファイルの更新
1. **`config.php`の更新** - 新しいデータベース情報に変更
2. **`update_config_for_new_db.php`の実行** - 自動更新スクリプトの実行

### ステップ2: 接続テスト
3. **接続テスト** - `test_new_database.php`で接続確認
4. **アプリケーションテスト** - システム全体の動作確認

### ステップ3: データ移行（必要に応じて）
5. **バックアップ作成** - `backup_database.php`で現在のデータをバックアップ
6. **データ復元** - `restore_database.php`で新しいデータベースにデータを復元

## ⚠️ 重要な注意点

### セキュリティ
- **`config.php`** が最も重要で、このファイルを更新すれば他のファイルは基本的に自動的に新しい設定を使用します
- セキュリティのため、本番環境では設定ファイルの権限を適切に設定してください

### データベーススキーマ変更時
- データベーススキーマ（テーブル構造）が変更された場合は、`database.php`内のクエリも修正が必要
- 新しいテーブルやカラムが追加された場合は、対応するクエリを追加・修正する必要があります

### バックアップの重要性
- データベース変更前には必ずバックアップを作成してください
- 変更作業は本番環境ではなく、テスト環境で事前に確認することを推奨します

## 📝 チェックリスト

- [ ] `config.php`のデータベース設定を更新
- [ ] `update_config_for_new_db.php`を実行
- [ ] `test_new_database.php`で接続テスト
- [ ] アプリケーションの動作確認
- [ ] 必要に応じてデータの移行
- [ ] セキュリティ設定の確認

## 🔗 関連ファイル

- **データベーススキーマ**: `road-design/database_schema.sql`
- **API設定**: `road-design/api.php`
- **認証設定**: `road-design/auth.php`

---

**作成日**: 2024年12月19日  
**対象システム**: 道路詳細設計管理システム  
**バージョン**: 1.0
